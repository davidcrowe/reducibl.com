```yaml
layout: post
title: "build log: 2026-02-02"
description: "I built a daily GTM digest agent that pulls data from various sources, synthesizes it with Gemini, and emails a report."
```

### what i built today

i implemented a scheduled cloud function to aggregate data from different monitors, synthesize insights with gemini, and send a digest email. this is for a daily gtm (go-to-market) report. i created the monitor modules and the main digest handler.

### implementing the daily gtm digest agent

i started by defining the architecture â€” a scheduled function that loads a config from firestore, runs monitors in parallel, synthesizes the results with gemini, and sends an email via resend.

i defined the monitor config in firestore:

```json
{
  "monitors": [
    { "type": "plausible", "enabled": true, "siteId": "innerdreamapp.com" },
    { "type": "plausible", "enabled": false, "siteId": "learnart.app" },
    { "type": "waitlist", "enabled": true, "collection": "waitlist" },
    { "type": "reddit", "enabled": true, "subreddits": ["ChatGPT", "ChatGPTPro", "OpenAI"], "keywords": ["inner", "dream journal", "memory orb"] },
    { "type": "hackernews", "enabled": true, "keywords": ["dream journal", "emotional tracking", "mcp app"] },
    { "type": "webScrape", "enabled": true, "urls": ["https://news.ycombinator.com/newest"], "keywords": ["dream", "journal", "emotional"] }
  ],
  "email": "david@reducibl.com",
  "timezone": "America/Los_Angeles"
}
```

then i started creating the files. first, the types:

```typescript
export interface PlausibleMonitorConfig {
  type: "plausible";
  enabled: boolean;
  siteId: string;
}

export interface WaitlistMonitorConfig {
  type: "waitlist";
  enabled: boolean;
  collection: string;
}

// ... other monitor configs

export type MonitorConfig =
  | PlausibleMonitorConfig
  | WaitlistMonitorConfig
  | RedditMonitorConfig
  | HackerNewsMonitorConfig
  | WebScrapeMonitorConfig;

export interface MonitorResult {
  type: MonitorConfig["type"];
  label: string;
  data: Record<string, unknown>;
  error?: string;
}

export interface DigestConfig {
  monitors: MonitorConfig[];
  email: string;
  timezone: string;
}
```

then i created the monitor modules for plausible, waitlist, reddit, hackernews, and webscrape. each module fetches data from its respective source and returns a `monitorresult`.

for example, the plausible monitor looks like this:

```typescript
import { PlausibleMonitorConfig, MonitorResult } from "./types";

const PLAUSIBLE_BASE = "https://plausible.io/api/v1";

export async function runPlausibleMonitor(
  config: PlausibleMonitorConfig
): Promise<MonitorResult> {
  const apiKey = process.env.PLAUSIBLE_API_KEY;
  if (!apiKey) {
    return { type: "plausible", label: `Plausible (${config.siteId})`, data: {}, error: "PLAUSIBLE_API_KEY not set" };
  }

  // ... fetch and process data
}
```

finally, i created the main `dailyDigest.ts` handler. this function loads the config, runs the enabled monitors, synthesizes the results with gemini, and sends an email via resend.

i added the new function to `src/index.ts`:

```typescript
import { dailyDigest as dailyDigestHandler } from "./handlers/dailyDigest";

// â€¦ later with your other onRequest exports:
export const dailyDigest = onSchedule(
  {
    schedule: "0 6 * * *",
    timeZone: "America/Los_Angeles",
    memory: "512MiB",
    timeoutSeconds: 120,
  },
  async (event: ScheduledEvent) => {
    await dailyDigestHandler(event);
  }
);
```

i also added `PLAUSIBLE_API_KEY` and `RESEND_API_KEY` to `.env`.

i had some linting errors related to indentation, but claude fixed them.

i seeded the firestore config document with the monitor config.

the deploy failed at first because of type issues, but i fixed them by adding type assertions.

finally, i deployed the function.

```text
=== Deploying to 'trim-glazing-445021-n8'...
i  deploying functions
Running command: npm --prefix "$RESOURCE_DIR" run lint
> lint
> eslint .
Running command: npm --prefix "$RESOURCE_DIR" run build
> build
> tsc
âœ”  functions: Finished running predeploy script.
i  functions: preparing codebase default for deployment
i  functions: ensuring required API cloudfunctions.googleapis.com is enabled...
i  functions: ensuring required API cloudbuild.googleapis.com is enabled...
i  artifactregistry: ensuring required API artifactregistry.googleapis.com is enabled...
âš   functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory.
âš   functions: Please note that there will be breaking changes when you upgrade.
i  functions: Loading and analyzing source code for codebase default to determine what to deploy
Serving at port 8269
ðŸš€ Initializing Firebase App...
ðŸ“‚ Connecting to Firestore...
ðŸ”§ Firestore settings applied
[toolGatewayHandler] module loaded
[cfg] {
  OAUTH_ISSUER: 'https://dev-e2r87v477lvku60t.us.auth0.com',
  OAUTH_AUDIENCE: 'https://inner.app/api',
  JWKS_URI_FALLBACK: 'https://dev-e2r87v477lvku60t.us.auth0.com/.well-known/jwks.json',
  FUNCTIONS_BASE: 'https://us-central1-trim-glazing-445021-n8.cloudfunctions.net',
  APP_ORIGIN: '*'
}
[toolGatewayHandler] module loaded
[cfg] {
  OAUTH_ISSUER: 'https://dev-e2r87v477lvku60t.us.auth0.com',
  OAUTH_AUDIENCE: 'https://inner.app/api',
  JWKS_URI_FALLBACK: 'https://dev-e2r87v477lvku60t.us.auth0.com/.well-known/jwks.json',
  FUNCTIONS_BASE: 'https://us-central1-trim-glazing-445021-n8.cloudfunctions.net',
  APP_ORIGIN: '*'
}
[toolGatewayHandler] module loaded
i  extensions: ensuring required API firebaseextensions.googleapis.com is enabled...
i  functions: Loaded environment variables from .env.
i  functions: preparing functions directory for uploading...
i  functions: packaged /Users/davidcrowe/dream-backend/functions (31.45 MB) for uploading
i  functions: ensuring required API cloudscheduler.googleapis.com is enabled...
i  functions: ensuring required API run.googleapis.com is enabled...\ni  functions: ensuring required API eventarc.googleapis.com is enabled...\ni  functions: ensuring required API pubsub.googleapis.com is enabled...\ni  functions: ensuring required API storage.googleapis.com is enabled...\ni  functions: generating the service identity for pubsub.googleapis.com...\ni  functions: generating the service identity for eventarc.googleapis.com...
```

all set.
SKIP